---
import Layout from '../../layouts/Layout.astro';
import fs from 'fs';
import path from 'path';

const { params } = Astro;
const licenseFile = `${params.license}.txt`;

const licensesDir = path.resolve('./src/db');
const content = fs.readFileSync(path.join(licensesDir, licenseFile), 'utf-8');
const [metadataSection, bodySection] = content.split('---').filter(section => section.trim() !== '');
const metadataLines = metadataSection.trim().split('\n');
const metadata = {};
metadataLines.forEach(line => {
  const [key, value] = line.split(':').map(s => s.trim());
  if (key && value) {
    metadata[key] = value;
  }
});
metadata.body = bodySection.trim();
---

<Layout>
  <div class="container mx-auto px-4 py-8">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-2">{metadata.title}</h1>
      <p class="text-lg mb-4 italic text-gray-600">{metadata.description}</p>
    </header>
    <div class="bg-gray-100 dark:bg-gray-900 p-4 rounded border border-gray-300 dark:border-gray-700">
      <pre class="whitespace-pre-wrap"><code>{metadata.body}</code></pre>
    </div>
    <div class="mt-8">
      <h2 class="text-2xl font-bold mb-2">Permissions</h2>
      <ul class="list-disc list-inside mb-4">
        {metadata.permissions && metadata.permissions.length > 0 ? (
          metadata.permissions.map(permission => (
            <li>{permission}</li>
          ))
        ) : (
          <li>None</li>
        )}
      </ul>
      <h2 class="text-2xl font-bold mb-2">Limitations</h2>
      <ul class="list-disc list-inside mb-4">
        {metadata.limitations && metadata.limitations.length > 0 ? (
          metadata.limitations.map(limitation => (
            <li>{limitation}</li>
          ))
        ) : (
          <li>None</li>
        )}
      </ul>
      <h2 class="text-2xl font-bold mb-2">Conditions</h2>
      <ul class="list-disc list-inside">
        {metadata.conditions && metadata.conditions.length > 0 ? (
          metadata.conditions.map(condition => (
            <li>{condition}</li>
          ))
        ) : (
          <li>None</li>
        )}
      </ul>
    </div>
  </div>
</Layout>
